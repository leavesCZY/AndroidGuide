> å…¬ä¼—å·ï¼š[å­—èŠ‚æ•°ç»„](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/adbc507fc3704fd8955aae739a433db2~tplv-k3u1fbpfcp-zoom-1.image)
>
> å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£

> æœ¬ç³»åˆ—æ–‡ç« ä¼šé™†ç»­å¯¹ Java å’Œ Android çš„é›†åˆæ¡†æ¶ï¼ˆJDK 1.8ï¼ŒAndroid SDK 30ï¼‰ä¸­çš„å‡ ä¸ªå¸¸è§å®¹å™¨ç»“åˆæºç è¿›è¡Œä»‹ç»ï¼Œäº†è§£ä¸åŒå®¹å™¨åœ¨**æ•°æ®ç»“æ„ã€é€‚ç”¨åœºæ™¯ã€ä¼˜åŠ¿ç‚¹**ä¸Šçš„ä¸åŒï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£

# ä¸€ã€æ•°ç»„å’Œé“¾è¡¨

å¾ˆå¤šé›†åˆæ¡†æ¶åœ¨åº•å±‚ç»“æ„éƒ½ä½¿ç”¨åˆ°äº†**æ•°ç»„**å’Œ**é“¾è¡¨**è¿™ä¸¤ç§æ•°æ®ç»“æ„ï¼Œå®ƒä»¬åœ¨**æ•°æ®å­˜å‚¨æ–¹å¼**å’Œ**ä¼˜åŠ£ç‚¹**è¿™ä¸¤æ–¹é¢æœ‰ç€å¾ˆå¤§åŒºåˆ«ï¼Œè¿™é‡Œå…ˆæ¥ä»‹ç»ä¸‹è¿™ä¸¤è€…çš„ç»“æ„å’ŒåŒºåˆ«

## 1ã€æ•°ç»„

å‡è®¾ç°åœ¨æœ‰å…­ä¸ªå…ƒç´ å­˜æ”¾åœ¨æ•°ç»„ä¸­ï¼Œåˆ™æ•°ç»„åœ¨å†…å­˜ä¸­çš„å­˜å‚¨ç»“æ„å°±å¦‚ä¸‹æ‰€ç¤º

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d35e498da26c4619acab1229db882021~tplv-k3u1fbpfcp-zoom-1.image)

1. æ•°ç»„æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå…ƒç´ æŒ‰ç…§åæ ‡ç´¢å¼•ä¾æ¬¡æ’åˆ—ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡åæ ‡å®šä½åˆ°æ¯ä¸€ä¸ªæ•°æ®çš„å†…å­˜åœ°å€ï¼Œä¾‹å¦‚å¯ä»¥ç›´æ¥é€šè¿‡åæ ‡ 3 è·å–åˆ° element4ï¼Œçœå»äº†ä»å¤´åˆ°å°¾çš„éå†æ“ä½œï¼Œå› æ­¤éšæœºè¯»å–æ•°æ®çš„æ•ˆç‡è¾ƒé«˜
2. ç›¸å¯¹åº”çš„ï¼Œç”±äºæ•°ç»„è¦æ±‚å…ƒç´ æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œå› æ­¤åœ¨æ·»åŠ å’Œç§»é™¤æ•°æ®æ—¶æœ‰å¯èƒ½éœ€è¦ç§»åŠ¨å¤§é‡æ•°æ®ï¼Œæ‰€ä»¥åœ¨æ·»åŠ å’Œç§»é™¤æ•°æ®æ—¶æ•ˆç‡è¾ƒä½
3. æ•°ç»„åœ¨ä½¿ç”¨å‰éœ€è¦å…ˆæŒ‡å®šå…¶ç©ºé—´å¤§å°ï¼Œåœ¨å£°æ˜ç©ºé—´å¤§å°åæ— æ³•å†æ¬¡ä¿®æ”¹ã€‚å¦‚æœæˆ‘ä»¬åœ¨ä½¿ç”¨å‰å·²çŸ¥å¾…å­˜å…¥çš„æ•°æ®é‡çš„è¯ï¼Œè‡ªç„¶å¯ä»¥å°†æ•°ç»„åˆå§‹åŒ–ä¸ºç›®æ ‡å®¹é‡ï¼Œè¿™æ ·å°±ä¸ä¼šæµªè´¹å†…å­˜ç©ºé—´äº†ã€‚ä½†å®é™…ä¸Šæ•°æ®é‡å¾€å¾€æ˜¯æœªçŸ¥çš„ï¼Œç»å¸¸ä¼šå› ä¸ºç”³è¯·äº†è¾ƒå¤§çš„å†…å­˜ç©ºé—´å¯¼è‡´æµªè´¹ï¼Œæˆ–è€…æ˜¯ç”³è¯·å°‘äº†å¯¼è‡´éœ€è¦åç»­æ‰©å®¹ï¼Œè€Œæ•°ç»„åœ¨æ‰©å®¹æ—¶åªèƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„å¹¶å°†æ•°æ®æ•´ä½“è¿ç§»ï¼Œè¿™å°±å½±å“åˆ°äº†æ•°ç»„çš„è¿è¡Œæ€§èƒ½

ArrayList åº•å±‚å°±æ˜¯ç”¨æ•°ç»„æ¥å­˜å‚¨æ•°æ®

## 2ã€é“¾è¡¨

å‡è®¾ç°åœ¨æœ‰å››ä¸ªå…ƒç´ ä¾é é“¾è¡¨æ¥å­˜æ”¾ï¼Œé“¾è¡¨åœ¨å†…å­˜ä¸­çš„å­˜å‚¨ç»“æ„å°±å¦‚ä¸‹æ‰€ç¤º

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/073ecd6842734463804b9fc6dcbd151d~tplv-k3u1fbpfcp-zoom-1.image)

1. å›¾ä¸­æ‰€å±•ç¤ºçš„æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå³æ¯ä¸ªç»“ç‚¹é™¤äº†åŒ…å«å®é™…çš„æ•°æ®å¤–ï¼Œè¿˜å­˜åœ¨ä¸¤ä¸ªå¼•ç”¨åˆ†åˆ«æŒ‡å‘ä¸Šä¸€ä¸ªç»“ç‚¹ï¼ˆprevï¼‰å’Œä¸‹ä¸€ä¸ªç»“ç‚¹ï¼ˆnextï¼‰ï¼Œå„ä¸ªç»“ç‚¹é€šè¿‡è¿™ç§åŒå‘é“¾æ¥ä»è€Œä¸²è”åœ¨ä¸€èµ·ã€‚æ­¤å¤–è¿˜å­˜åœ¨ä¸¤ä¸ªå¼•ç”¨åˆ†åˆ«æŒ‡å‘å¤´ç»“ç‚¹ï¼ˆfirstï¼‰å’Œå°¾ç»“ç‚¹ï¼ˆlastï¼‰ï¼Œæ–¹ä¾¿è¿›è¡Œæ­£å‘éå†å’Œåå‘éå†
2. é“¾è¡¨ä¸è¦æ±‚æœ‰è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œæ–°æ·»åŠ çš„ç»“ç‚¹å¯ä»¥åœ¨å†…å­˜ä¸­çš„ä»»ä½•ä½ç½®ï¼Œåªè¦ä¸Šä¸€ä¸ªç»“ç‚¹å’Œä¸‹ä¸€ä¸ªç»“ç‚¹äº’ç›¸ä¿å­˜æœ‰å¯¹æ–¹çš„å¼•ç”¨å³å¯ï¼Œè¿™ä¹Ÿå¯¼è‡´åœ¨éšæœºè®¿é—®æ•°æ®æ—¶åªèƒ½éå†æ•´ä¸ªé“¾è¡¨ï¼Œåœ¨æœ€åçš„æƒ…å†µä¸‹ç”šè‡³éœ€è¦å…¨é‡éå†ã€‚å½“ç„¶ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µæ¥é€‰æ‹©æ˜¯æ­£å‘éå†è¿˜æ˜¯åå‘éå†ï¼Œä»¥æ­¤æé«˜è®¿é—®æ•ˆç‡ï¼Œä½†æ€»çš„æ¥è¯´é“¾è¡¨åœ¨éšæœºè®¿é—®æ•°æ®æ—¶æ•ˆç‡è¦æ¯”æ•°ç»„ä½
3. åœ¨æ·»åŠ æˆ–ç§»é™¤å…ƒç´ æ—¶ï¼Œåªéœ€è¦ä¿®æ”¹ç›¸é‚»ç»“ç‚¹å¯¹æŒ‡å®šç»“ç‚¹çš„å¼•ç”¨å³å¯ï¼Œè€Œä¸éœ€åƒæ•°ç»„é‚£æ ·éœ€è¦ç§»åŠ¨å…ƒç´ ï¼Œå› æ­¤é“¾è¡¨åœ¨æ·»åŠ å’Œç§»é™¤å…ƒç´ æ—¶æ•ˆç‡è¾ƒé«˜
4. é“¾è¡¨ä¸éœ€äº‹å…ˆç”³è¯·å†…å­˜ç©ºé—´ï¼Œæ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè¿›è¡ŒåŠ¨æ€ç”³è¯·å³å¯
5. æ­¤å¤–è¿˜å­˜åœ¨ä¸€ç§å•å‘é“¾è¡¨çš„ç»“æ„ï¼Œå³æ¯ä¸ªç»“ç‚¹åŒ…å«å¯¹ä¸‹ä¸€ä¸ªç»“ç‚¹çš„å¼•ç”¨ nextï¼Œä½†ä¸åŒ…å« prevï¼Œæ‰€ä»¥å•å‘é“¾è¡¨åªèƒ½ä»å¤´åˆ°å°¾è¿›è¡Œéå†

LinkedList åº•å±‚å°±æ˜¯ç”¨é“¾è¡¨æ¥å­˜å‚¨æ•°æ®

# äºŒã€ArrayList 

ArrayList åº”è¯¥æ˜¯å¤§å¤šæ•°å¼€å‘è€…ä½¿ç”¨å¾—æœ€ä¸ºé¢‘ç¹çš„é›†åˆå®¹å™¨äº†ï¼ŒArrayList å®ç°äº† List æ¥å£ï¼Œæ˜¯ä¸€ä¸ªæœ‰åºå®¹å™¨ï¼Œå³å…ƒç´ çš„å­˜æ”¾é¡ºåºä¸æ·»åŠ é¡ºåºä¿æŒä¸€è‡´ï¼Œå…è®¸æ·»åŠ ç›¸åŒå…ƒç´ ï¼ŒåŒ…æ‹¬ null ã€‚ArrayList åº•å±‚é€šè¿‡æ•°ç»„æ¥è¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œå½“å‘ ArrayList ä¸­æ·»åŠ å…ƒç´ æ—¶å¦‚æœå‘ç°æ•°ç»„ç©ºé—´ä¸è¶³ï¼ŒArrayList ä¼šè‡ªåŠ¨å¯¹åº•å±‚æ•°ç»„è¿›è¡Œæ‰©å®¹å¹¶è¿ç§»ç°æœ‰æ•°æ®

## 1ã€ç±»å£°æ˜

ä» ArrayList å®ç°çš„æ¥å£å¯ä»¥çœ‹å‡ºæ¥å®ƒæ˜¯æ”¯æŒå¿«é€Ÿè®¿é—®ï¼Œå¯å…‹éš†ï¼Œå¯åºåˆ—åŒ–çš„

```java
public class ArrayList<E> extends AbstractList<E> 
    implements List<E>, RandomAccess, Cloneable, java.io.Serializable
```

## 2ã€æˆå‘˜å˜é‡

ArrayList ä¸€å…±åŒ…å«ä»¥ä¸‹å‡ ä¸ªæˆå‘˜å˜é‡ï¼Œä¸»è¦çœ‹ elementDataã€‚elementData æ˜¯ç”¨äºå­˜æ”¾æ•°æ®çš„åº•å±‚æ•°ç»„ï¼Œç”±äºå…¶æ•°æ®ç±»å‹å£°æ˜ä¸º Objectï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ¥å­˜æ”¾ä»»ä½•ç±»å‹çš„æ•°æ®ã€‚è€Œ ArrayList å±äºæ³›å‹ç±»ï¼Œå¦‚æœæˆ‘ä»¬åœ¨åˆå§‹åŒ–æ—¶å°±æŒ‡å®šäº†æ•°æ®ç±»å‹çš„è¯ï¼Œä¾é  Java æ³›å‹ä¸ºæˆ‘ä»¬æä¾›çš„è¯­æ³•ç³–ï¼Œæˆ‘ä»¬åœ¨å‘ elementData å­˜å–æ•°æ®æ—¶ç¼–è¯‘å™¨å°±ä¼šè‡ªåŠ¨è¿›è¡Œç±»å‹æ ¡éªŒå’Œç±»å‹è½¬æ¢ï¼Œç¡®ä¿å­˜å…¥å’Œå–å‡ºçš„æ•°æ®ç±»å‹æ˜¯å®‰å…¨çš„

```java
//åºåˆ—åŒ–ID
private static final long serialVersionUID = 8683452581122892189L;

//è¿›è¡Œæ‰©å®¹æ“ä½œåçš„æœ€å°å®¹é‡
private static final int DEFAULT_CAPACITY = 10;

//å¦‚æœå¤–éƒ¨ä¸ºé›†åˆè®¾ç½®çš„åˆå§‹åŒ–å¤§å°ä¸º 0ï¼Œåˆ™å°† elementData æŒ‡å‘æ­¤ç©ºæ•°ç»„
private static final Object[] EMPTY_ELEMENTDATA = {};

//å¦‚æœåœ¨åˆå§‹åŒ–é›†åˆæ—¶ä½¿ç”¨çš„æ˜¯æ— å‚æ„é€ å‡½æ•°ï¼Œåˆ™å°† elementData æŒ‡å‘æ­¤ç©ºæ•°ç»„
private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};

//ç”¨æ¥å­˜æ”¾å…ƒç´ çš„æ•°ç»„
transient Object[] elementData;

//é›†åˆå¤§å°
private int size;

//ArrayList çš„å¿«ç…§ç‰ˆæœ¬å·
protected transient int modCount = 0;
```

## 3ã€æ„é€ å‡½æ•°

å¦‚æœå·²ç»çŸ¥é“ç›®æ ‡æ•°æ®é‡å¤§å°çš„è¯ï¼Œåœ¨åˆå§‹åŒ– ArrayList çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¼ å…¥æœ€ç»ˆçš„å®¹é‡å€¼ï¼Œè¿™æ ·æ•ˆç‡ä¼šæ›´é«˜ä¸€äº›ã€‚å› ä¸ºå¦‚æœ initialCapacity è¿‡å¤§ï¼Œåˆ™ä¼šé€ æˆå†…å­˜æµªè´¹ï¼›å¦‚æœ initialCapacity è¿‡å°ï¼Œå¯èƒ½ä¼šå¯¼è‡´åç»­éœ€è¦å¤šæ¬¡æ‰©å®¹ï¼Œæ¯æ¬¡æ‰©å®¹éƒ½éœ€è¦å¤åˆ¶åŸæœ‰æ•°æ®åˆ°æ–°æ•°ç»„ï¼Œè¿™ä¼šé™ä½è¿è¡Œæ•ˆç‡

å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æ— å‚æ„é€ å‡½æ•°æˆ–è€…æ˜¯æŒ‡å®šçš„ initialCapacity ä¸º 0ï¼Œæ­¤æ—¶ä¹Ÿåªä¼šå°† elementData æŒ‡å‘ç©ºæ•°ç»„ï¼Œå¹¶ä¸ä¼šæ–°å»ºä¸€ä¸ªæ•°ç»„å˜é‡

```java
//æŒ‡å®šé›†åˆçš„åˆå§‹å®¹é‡ï¼Œä»¥æ­¤æ¥è¿›è¡Œæ•°ç»„çš„åˆå§‹åŒ–æ“ä½œ
public ArrayList(int initialCapacity) {
    if (initialCapacity > 0) {
        this.elementData = new Object[initialCapacity];
    } else if (initialCapacity == 0) {
        this.elementData = EMPTY_ELEMENTDATA;
    } else {
        throw new IllegalArgumentException("Illegal Capacity: "+initialCapacity);
    }
}

//å¤–éƒ¨æ²¡æœ‰æŒ‡å®šåˆå§‹å®¹é‡ï¼Œæš‚ä¸”ä½¿ç”¨ç©ºæ•°ç»„
public ArrayList() {
    this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;
}

//ä¼ å…¥ä¸€ä»½åˆå§‹æ•°æ®æ¥è¿›è¡Œåˆå§‹åŒ–
public ArrayList(Collection<? extends E> c) {
    elementData = c.toArray();
    if ((size = elementData.length) != 0) {
        // c.toArray might (incorrectly) not return Object[] (see 6260652)
        if (elementData.getClass() != Object[].class)
            elementData = Arrays.copyOf(elementData, size, Object[].class);
    } else {
        this.elementData = EMPTY_ELEMENTDATA;
    }
}
```

## 4ã€è·å–å…ƒç´ 

åœ¨è·å–æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ æ—¶ï¼ŒArrayList éƒ½æ˜¯ç›´æ¥é€šè¿‡åæ ‡å€¼æ¥è·å–å…ƒç´ ï¼Œæ— éœ€ä»å¤´éå†ï¼Œæ‰€ä»¥è¯´ ArrayList éå†å’Œéšæœºè®¿é—®çš„æ•ˆç‡è¾ƒé«˜

```java
@SuppressWarnings("unchecked")
E elementData(int index) {
    return (E) elementData[index];
}

public E get(int index) {
    //åˆ¤æ–­å–å€¼èŒƒå›´æ˜¯å¦åˆæ³•
    rangeCheck(index);
    return elementData(index);
}
```

## 5ã€æ·»åŠ å…ƒç´ 

ArrayList æ·»åŠ å…ƒç´ çš„æ“ä½œå°±ä¸æ˜¯é‚£ä¹ˆç†æƒ³äº†ã€‚å¦‚æœæ˜¯ç›´æ¥å‘é›†åˆå°¾ç«¯æ·»åŠ æ•°æ®ï¼Œé‚£ä¹ˆç›´æ¥å®šä½åˆ°è¯¥ä½ç½®è¿›è¡Œèµ‹å€¼å³å¯ï¼›å¦‚æœæ˜¯å‘é›†åˆçš„ä¸­é—´ä½ç½® index æ’å…¥æ•°æ®ï¼Œåˆ™éœ€è¦å°†æ•°ç»„ä¸­ç´¢å¼• index åçš„æ‰€æœ‰æ•°æ®å‘åæ¨ç§»ä¸€ä½ï¼Œç„¶åå°†æ•°æ®æ’å…¥åˆ°ç©ºå‡ºçš„ä½ç½®ä¸Šã€‚æ­¤å¤–ï¼Œåœ¨æ’å…¥æ•°æ®å‰ elementData å¯èƒ½å·²ç»ç©ºé—´ä¸è¶³äº†ï¼Œé‚£ä¹ˆè¿˜éœ€è¦å…ˆè¿›è¡Œæ‰©å®¹æ“ä½œã€‚æ‰©å®¹æ“ä½œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç¬¦åˆå¤§å°çš„æ•°ç»„ï¼Œå¹¶å°†åŸæ•°ç»„ä¸­çš„æ•°æ®è¿ç§»åˆ°æ–°æ•°ç»„ä¸­ï¼Œç„¶åè®© elementData æŒ‡å‘æ–°æ•°ç»„

ç”±æ­¤å¯ä»¥çœ‹å‡ºæ¥ï¼Œå‘é›†åˆæ·»åŠ æ•°æ®å’Œè¿›è¡Œæ‰©å®¹éƒ½å¯èƒ½ä¼šå¯¼è‡´æ•°ç»„å…ƒç´ å¤§é‡ç§»åŠ¨ï¼Œæ‰€ä»¥è¯´ ArrayList å­˜å…¥æ•°æ®çš„æ•ˆç‡å¹¶ä¸é«˜

```java
public boolean add(E e) {
    //åœ¨éœ€è¦çš„æ—¶å€™è¿›è¡Œæ‰©å®¹
    ensureCapacityInternal(size + 1);
    elementData[size++] = e;
    return true;
}

public void add(int index, E element) {
    rangeCheckForAdd(index);
    //åœ¨éœ€è¦çš„æ—¶å€™è¿›è¡Œæ‰©å®¹
    ensureCapacityInternal(size + 1);
    //å°†ç´¢å¼• index åçš„æ‰€æœ‰æ•°å€¼å‘åæ¨ç§»ä¸€ä½ 
    System.arraycopy(elementData, index, elementData, index + 1,size - index);
    elementData[index] = element;
    size++;
}
```

ä»¥ä¸Šè¯´çš„æ˜¯å­˜å…¥å•ä¸ªæ•°æ®çš„æƒ…å†µï¼Œæ­¤å¤–è¿˜æœ‰å­˜å…¥æ•´ä¸ªé›†åˆçš„æƒ…å†µ

```java
//å¦‚æœå¾…æ·»åŠ çš„æ•°æ®ä¸ä¸ºç©ºåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› false
public boolean addAll(Collection<? extends E> c) {
    Object[] a = c.toArray();
    int numNew = a.length;
    ensureCapacityInternal(size + numNew);
    //å°†æ•°ç»„ a å¤åˆ¶åˆ° elementData çš„å°¾ç«¯
    System.arraycopy(a, 0, elementData, size, numNew);
    size += numNew;
    return numNew != 0;
}

//ä»æŒ‡å®šç´¢å¼•å¤„æ·»åŠ æ•°æ®ï¼Œå¦‚æœå¾…æ·»åŠ çš„æ•°æ®ä¸ä¸ºç©ºåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› false
public boolean addAll(int index, Collection<? extends E> c) {
    rangeCheckForAdd(index);
    Object[] a = c.toArray();
    int numNew = a.length;
    ensureCapacityInternal(size + numNew);
    //éœ€è¦ç§»åŠ¨çš„æ•°ç»„å…ƒç´ æ•°é‡
    int numMoved = size - index;
    //å› ä¸ºè¦æ·»åŠ çš„æ•°æ®å¯èƒ½åˆšå¥½æ˜¯ä»æ•°ç»„æœ€å°¾ç«¯å¼€å§‹æ·»åŠ ï¼Œæ‰€ä»¥ numMoved å¯èƒ½ä¸º 0
    //æ‰€ä»¥åªåœ¨ numMoved > 0 çš„æ—¶å€™æ‰éœ€è¦å¯¹æ•°ç»„çš„å…ƒç´ å€¼è¿›è¡Œç§»åŠ¨ï¼Œä»¥æ­¤ç©ºå‡ºä½ç½®ç»™æ•°ç»„ a
    if (numMoved > 0)
        System.arraycopy(elementData, index, elementData, index + numNew, numMoved);
    //å°†æ•°ç»„ a åŒ…å«çš„æ•°æ®æ·»åŠ åˆ° elementData ä¸­
    System.arraycopy(a, 0, elementData, index, numNew);
    size += numNew;
    return numNew != 0;
}
```

## 6ã€ç§»é™¤å…ƒç´ 

å› ä¸ºæ•°ç»„æ˜¯ä¸€ç§å†…å­˜åœ°å€è¿ç»­çš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥ç§»é™¤æŸä¸ªå…ƒç´ åŒæ ·å¯èƒ½å¯¼è‡´å¤§é‡å…ƒç´ ç§»åŠ¨

```java
//ç§»é™¤æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ å€¼ï¼Œå¹¶è¿”å›è¯¥å€¼
public E remove(int index) {
    rangeCheck(index);
    modCount++;
    //å¾…ç§»é™¤çš„å…ƒç´ å€¼
    E oldValue = elementData(index);
    //å› ä¸ºè¦ç§»é™¤å…ƒç´ å¯¼è‡´éœ€è¦ç§»åŠ¨çš„å…ƒç´ æ•°é‡
    int numMoved = size - index - 1;
    //å› ä¸ºè¦ç§»é™¤çš„å…ƒç´ å¯èƒ½åˆšå¥½æ˜¯æ•°ç»„æœ€åä¸€ä½ï¼Œæ‰€ä»¥ numMoved å¯èƒ½ä¸º 0
    //æ‰€ä»¥åªåœ¨ numMoved > 0 çš„æ—¶å€™æ‰éœ€è¦å¯¹æ•°ç»„çš„å…ƒç´ å€¼è¿›è¡Œç§»åŠ¨
    if (numMoved > 0)
        System.arraycopy(elementData, index+1, elementData, index, numMoved);
    //ä¸ç®¡æ•°ç»„æ˜¯å¦éœ€è¦å¯¹å…ƒç´ å€¼è¿›è¡Œç§»åŠ¨ï¼Œæ•°ç»„çš„æœ€åä¸€ä½éƒ½æ˜¯æ— æ•ˆæ•°æ®äº†
    //æ­¤å¤„å°†ä¹‹ç½®ä¸º null ä»¥å¸®åŠ©GCå›æ”¶                
    elementData[--size] = null;
    return oldValue;
}

//ç§»é™¤é›†åˆä¸­åŒ…å«çš„ç¬¬ä¸€ä½å…ƒç´ å€¼ä¸º o çš„å¯¹è±¡
//å¦‚æœåŒ…å«è¯¥å¯¹è±¡ï¼Œåˆ™è¿”å› true ï¼Œå¦åˆ™è¿”å› false
public boolean remove(Object o) {
    if (o == null) {
        for (int index = 0; index < size; index++)
            if (elementData[index] == null) {
                fastRemove(index);
                return true;
            }
    } else {
        for (int index = 0; index < size; index++)
            if (o.equals(elementData[index])) {
                fastRemove(index);
                return true;
            }
    }
    return false;
}
```

## 7ã€æ‰©å®¹æœºåˆ¶

å†æ¥çœ‹ä¸‹æ•°ç»„çš„æ‰©å®¹æœºåˆ¶çš„å…·ä½“å®ç°é€»è¾‘

`ensureCapacity` æ–¹æ³•çš„å…¥å‚å‚æ•° minCapacity å°±ç”¨äºæŒ‡å®šå¸Œæœ›æ‰©å®¹åçš„æœ€å°ç©ºé—´ï¼Œä½† minCapacity æœ€ç»ˆä¸ä¼šå°äº DEFAULT_CAPACITYï¼Œå³æ‰©å®¹åçš„æ•°ç»„å®¹é‡ä¸ä¼šå°äº 10ã€‚ä¹‹æ‰€ä»¥è¦è¿›è¡Œæœ€å°å®¹é‡çš„é™åˆ¶ï¼Œæ˜¯ä¸ºäº†å‡å°‘å¤šæ¬¡æ‰©å®¹çš„å¯èƒ½æ€§ï¼Œ10 ä»¥å†…çš„æ•°ç»„å¾ˆå®¹æ˜“å°±å‘ç”Ÿæ‰©å®¹

å¦‚æœåœ¨åˆå§‹åŒ– ArrayList å‰å·²çŸ¥ç›®æ ‡æ•°æ®çš„æ•°æ®é‡ï¼Œæœ€å¥½å°±ä½¿ç”¨`ArrayList(int initialCapacity)`æ¥è¿›è¡Œåˆå§‹åŒ–ï¼Œç›´æ¥è®©åº•å±‚æ•°ç»„æ‰©å……åˆ°ç›®æ ‡å¤§å°ï¼Œæˆ–è€…æ˜¯åœ¨æ·»åŠ æ•°æ®å‰å°±è°ƒç”¨ `ensureCapacity` æ–¹æ³•ç›´æ¥è®©æ•°ç»„æ‰©å®¹åˆ°ç›®æ ‡å¤§å°ï¼Œé¿å…ä¹‹åèµ‹å€¼è¿‡ç¨‹ä¸­å¤šæ¬¡æ‰©å®¹

```java
public void ensureCapacity(int minCapacity) {
    int minExpand = (elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA)
        ? 0
        : DEFAULT_CAPACITY;
    if (minCapacity > minExpand) {
        ensureExplicitCapacity(minCapacity);
    }
}

private void ensureCapacityInternal(int minCapacity) {
    if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {
        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);
    }
    ensureExplicitCapacity(minCapacity);
}

private void ensureExplicitCapacity(int minCapacity) {
    modCount++;
    //å¦‚æœå½“å‰æ•°ç»„å¤§å°çš„ç¡®æ˜¯æ¯”éœ€è¦çš„æœ€å°ç©ºé—´ minCapacity å°ï¼Œåˆ™è¿›è¡Œæ‰©å®¹
    if (minCapacity - elementData.length > 0)
        grow(minCapacity);
}
```

å®é™…ä¸Šå®Œæˆæ‰©å®¹æ“ä½œçš„æ˜¯ `grow(int minCapacity)` æ–¹æ³•ã€‚åœ¨æ‰©å®¹å‰ï¼Œä¼šå…ˆåˆ¤æ–­å¦‚æœå°†å®¹é‡æå‡åˆ°å½“å‰çš„ 1.5 å€æ˜¯å¦èƒ½è¾¾åˆ° minCapacity çš„è¦æ±‚ ï¼Œå¦‚æœç¬¦åˆè¦æ±‚åˆ™ç›´æ¥å°†å®¹é‡æ‰©å……åˆ°å½“å‰çš„ 1.5 å€ï¼Œå¦åˆ™æ‰©å……åˆ° minCapacityï¼Œä½†æœ€ç»ˆå®¹é‡ä¸èƒ½å¤§äº Integer.MAX_VALUE

æ„å»ºå‡ºä¸€ä¸ªæ–°çš„ç¬¦åˆå¤§å°çš„æ•°ç»„åï¼Œå°±å°†åŸæ•°ç»„ä¸­çš„å…ƒç´ å¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­ï¼Œè‡³æ­¤å°±å®Œæˆäº†æ‰©å®¹

```java
//æ•°ç»„å¯æ‰©å®¹åˆ°çš„æœ€å¤§å®¹é‡
private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;

private void grow(int minCapacity) {
    int oldCapacity = elementData.length;
    //å‡è®¾æ‰©å®¹åçš„ç©ºé—´å¤§å°æ˜¯åŸå…ˆçš„1.5å€
    int newCapacity = oldCapacity + (oldCapacity >> 1);
    if (newCapacity - minCapacity < 0)
        newCapacity = minCapacity;
    if (newCapacity - MAX_ARRAY_SIZE > 0)
        newCapacity = hugeCapacity(minCapacity);
    elementData = Arrays.copyOf(elementData, newCapacity);
}
```

## 8ã€ä¿®æ”¹å…ƒç´ 

```java
//å°†ç´¢å¼• index å‡ºçš„å…ƒç´ å€¼ç½®ä¸º elementï¼Œå¹¶è¿”å›åŸå§‹æ•°å€¼
public E set(int index, E element) {
    rangeCheck(index);
    E oldValue = elementData(index);
    elementData[index] = element;
    return oldValue;
}
```

## 9ã€éå†æ•°ç»„

éå†æ•°ç»„çš„æ–¹æ³•åŒ…å«ä»¥ä¸‹å‡ ä¸ªï¼Œé€»è¾‘éƒ½æ¯”è¾ƒç®€å•ï¼Œç›´æ¥çœ‹æ³¨é‡Šå³å¯ã€‚ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„çŸ¥è¯†ç‚¹æ˜¯çœ‹æ–¹æ³•å†…éƒ¨å¯¹ modCount çš„æ ¡éªŒ

```java
@Override
public void forEach(Consumer<? super E> action) {
    Objects.requireNonNull(action);
    final int expectedModCount = modCount;
    @SuppressWarnings("unchecked")
    final E[] elementData = (E[]) this.elementData;
    final int size = this.size;
    for (int i=0; modCount == expectedModCount && i < size; i++) {
        //å°†é›†åˆå…ƒç´ ä¾æ¬¡ä¼ é€’ç»™ accept æ–¹æ³•
        action.accept(elementData[i]);
    }
    //å¦‚æœ modCount å€¼è¢«æ”¹åŠ¨äº†ï¼Œè¯´æ˜éå†è¿‡ç¨‹ä¸­æ•°ç»„æœ‰è¢«æ”¹åŠ¨åˆ°
    //é‚£ä¹ˆå°±åœæ­¢éå†å¹¶æŠ›å‡ºå¼‚å¸¸
    if (modCount != expectedModCount) {
        throw new ConcurrentModificationException();
    }
}

//æŒ‰ç…§ç»™å®šè§„åˆ™å¯¹é›†åˆå…ƒç´ è¿›è¡Œè¿‡æ»¤ï¼Œå¦‚æœå…ƒç´ ç¬¦åˆè¿‡æ»¤è§„åˆ™é‚£å°±å°†ä¹‹ç§»é™¤
@Override
public boolean removeIf(Predicate<? super E> filter) {
    Objects.requireNonNull(filter);
    //è¦ç§»é™¤çš„å…ƒç´ ä¸ªæ•°
    int removeCount = 0;
    //ç”¨äºæ ‡è®°é›†åˆæ˜¯å“ªä¸ªç´¢å¼•ä½ç½®éœ€è¦è¢«ç§»é™¤
    final BitSet removeSet = new BitSet(size);
    final int expectedModCount = modCount;
    final int size = this.size;
    for (int i=0; modCount == expectedModCount && i < size; i++) {
        @SuppressWarnings("unchecked")
        final E element = (E) elementData[i];
        //ä¾æ¬¡åˆ¤æ–­é›†åˆå…ƒç´ æ˜¯å¦ç¬¦åˆè¿‡æ»¤è§„åˆ™
        if (filter.test(element)) {
            //set æ–¹æ³•å°†å¯¼è‡´ç´¢å¼•ä½ç½® i çš„å…ƒç´ å˜ä¸º true
            removeSet.set(i);
            removeCount++;
        }
    }
    //ä¸å…è®¸åœ¨æ’åºçš„è¿‡ç¨‹ä¸­é›†åˆè¢«å…¶å®ƒæ–¹æ³•ä¿®æ”¹äº†æ•°ç»„ï¼ˆä¾‹å¦‚ï¼šç§»é™¤å…ƒç´ ï¼‰
    if (modCount != expectedModCount) {
        throw new ConcurrentModificationException();
    }
    //åªæœ‰ removeCount > 0 æ‰è¯´æ˜éœ€è¦ç§»é™¤å…ƒç´ 
    final boolean anyToRemove = removeCount > 0;
    if (anyToRemove) {
        //é›†åˆç§»é™¤æŒ‡å®šå…ƒç´ åçš„å¤§å°
        final int newSize = size - removeCount;
        for (int i=0, j=0; (i < size) && (j < newSize); i++, j++) {
            //ç•¥è¿‡è¢«æ ‡è®°ä¸º true çš„ä½ç½®ï¼Œç›´æ¥è·³åˆ°ä¸éœ€è¦ç§»é™¤å…ƒç´ çš„æ•°ç»„ç´¢å¼•ä½
            i = removeSet.nextClearBit(i);
            //æœ‰æ•ˆæ•°æ®é€æ¸ä»å°¾éƒ¨å‘å¤´éƒ¨èšé›†
            elementData[j] = elementData[i];
        }
        //ç§»é™¤å°¾éƒ¨çš„æ— æ•ˆæ•°æ®ï¼Œæœ‰åˆ©äºGCå›æ”¶
        for (int k=newSize; k < size; k++) {
            elementData[k] = null;
        }
        this.size = newSize;
        //ä¸å…è®¸åœ¨æ’åºçš„è¿‡ç¨‹ä¸­é›†åˆè¢«å…¶å®ƒæ–¹æ³•ä¿®æ”¹äº†æ•°ç»„ï¼ˆä¾‹å¦‚ï¼šç§»é™¤å…ƒç´ ï¼‰
        if (modCount != expectedModCount) {
            throw new ConcurrentModificationException();
        }
        modCount++;
    }
    return anyToRemove;
}

//å°†é›†åˆå…ƒç´ éå†ä¼ é€’ç»™ operatorï¼Œå¹¶å°†åŸå§‹æ•°æ®æ›¿æ¢ä¸º operator çš„è¿”å›å€¼
@Override
@SuppressWarnings("unchecked")
public void replaceAll(UnaryOperator<E> operator) {
    Objects.requireNonNull(operator);
    final int expectedModCount = modCount;
    final int size = this.size;
    for (int i=0; modCount == expectedModCount && i < size; i++) {
        //ä¾æ¬¡ä¼ é€’æ•°ç»„å…ƒç´ ç»™ apply æ–¹æ³•ï¼Œå¹¶å°†å…¶è¿”å›å€¼æ›¿æ¢åŸå§‹æ•°æ®
        elementData[i] = operator.apply((E) elementData[i]);
    }
    //ä¸å…è®¸åœ¨æ’åºçš„è¿‡ç¨‹ä¸­é›†åˆè¢«å…¶å®ƒæ–¹æ³•ä¿®æ”¹äº†æ•°ç»„ï¼ˆä¾‹å¦‚ï¼šç§»é™¤å…ƒç´ ï¼‰
    if (modCount != expectedModCount) {
        throw new ConcurrentModificationException();
    }
    modCount++;
}
```

## 10ã€è¿­ä»£å™¨

ArrayList å†…éƒ¨åŒ…å«ä¸€ä¸ªç”¨äºè¿­ä»£å…ƒç´ çš„ Iterator å®ç°ç±»ï¼Œå…¶ç”¨æ³•å¦‚ä¸‹æ‰€ç¤º

```java
public static void main(String[] args) {
    List<String> stringList = new ArrayList<>();
    stringList.add("https://github.com/leavesCZY");
    Iterator<String> iterator = stringList.iterator();
    if (iterator.hasNext()) {
        String next = iterator.next();
        System.out.println(next);
    }
}
```

åœ¨è¿™é‡Œæœ‰ä¸ªå°ç»†èŠ‚ï¼ŒArrayList é‡Œå¤šå¤„ä½¿ç”¨åˆ°äº† modCount è¿™ä¸ªæˆå‘˜å˜é‡ï¼ŒmodCount ç›¸å½“äºå¯¹ ArrayList çš„ä¸€ä¸ªç®€å•â€œå¿«ç…§â€ï¼Œå³ç±»ä¼¼äº ArrayList çš„ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯å½“æ·»åŠ ã€ç§»é™¤å’Œä¿®æ”¹å…ƒç´ æ—¶ï¼ŒmodCount éƒ½ä¼šé€’å¢

åœ¨æˆ‘ä»¬éå† ArrayList çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœåŒæ—¶è¿›è¡Œå¢å‡å…ƒç´ çš„æ“ä½œï¼Œæˆ–è€…æ˜¯å­˜åœ¨å¤šçº¿ç¨‹åŒæ—¶å¢å‡å…ƒç´ ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´éå†ç»“æœå˜å¾—ä¸å¯é ï¼Œæˆ–è€…æ˜¯ç›´æ¥å°±å¯¼è‡´æ•°ç»„è¶Šç•Œå¼‚å¸¸ï¼Œæ‰€ä»¥ ArrayList å°±é€šè¿‡ modCount æ¥æ ‡è®°å½“å‰çš„è¿­ä»£è¡Œä¸ºæ˜¯å¦å¤„äºå¯é çŠ¶æ€ã€‚å¦‚æœåœ¨éå†æ•°ç»„å…ƒç´ çš„è¿‡ç¨‹ä¸­åˆ¤æ–­åˆ° modCount çš„å€¼å‰åå‘ç”Ÿäº†å˜åŒ–ï¼Œå°±è¯´æ˜åœ¨éå†è¿‡ç¨‹ä¸­ ArrayList è¢«æ”¹åŠ¨äº†ï¼Œæ­¤æ—¶å°±è®¤å®šéå†ç»“æœä¸å¯é ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒmodCount åšçš„åªæ˜¯ä¸€ä¸ªç®€å•æ ¡éªŒï¼Œæ— æ³•å‡†ç¡®åˆ¤æ–­å‡ºå½“å‰çš„éå†æ“ä½œå°±çœŸçš„æ˜¯å®‰å…¨çš„

```java
protected transient int modCount = 0;

public Iterator<E> iterator() {
    return new Itr();
}

private class Itr implements Iterator<E> {

    //lastRet æŒ‡å‘çš„å…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•
    int cursor;

    //æœ€åä¸€ä¸ªè¿”å›çš„å…ƒç´ çš„ç´¢å¼•
    //å¦‚æœå€¼ä¸º -1ï¼Œè¯´æ˜è¿˜æœªè¿”å›è¿‡å…ƒç´ æˆ–è€…æ”¹å…ƒç´ è¢«ç§»é™¤äº†
    int lastRet = -1;

    //ç”¨äºéªŒè¯é›†åˆçš„æ•°æ®ç»“æ„åœ¨è¿­ä»£çš„è¿‡ç¨‹ä¸­æ˜¯å¦è¢«ä¿®æ”¹äº†
    int expectedModCount = modCount;

    //æ˜¯å¦è¿˜æœ‰å…ƒç´ æœªè¢«éå†
    public boolean hasNext() {
        return cursor != size;
    }

    //è·å–ä¸‹ä¸€ä¸ªå…ƒç´ 
    @SuppressWarnings("unchecked")
    public E next() {
        checkForComodification();
        int i = cursor;
        //å¦‚æœç´¢å¼•å€¼è¶…å‡ºå–å€¼èŒƒå›´åˆ™æŠ›å‡ºå¼‚å¸¸
        if (i >= size)
            throw new NoSuchElementException();
        Object[] elementData = ArrayList.this.elementData;
        //å¦‚æœç´¢å¼•å€¼è¶…å‡ºæ•°ç»„çš„å¯ç´¢å¼•èŒƒå›´åˆ™æŠ›å‡ºå¼‚å¸¸
        if (i >= elementData.length)
            throw new ConcurrentModificationException();
        cursor = i + 1;
        return (E) elementData[lastRet = i];
    }

    //ç§»é™¤ lastRet æŒ‡å‘çš„å…ƒç´ 
    public void remove() {
        if (lastRet < 0)
            throw new IllegalStateException();
        checkForComodification();
        try {
            ArrayList.this.remove(lastRet);
            //å› ä¸º lastRet ä½ç½®åŸå§‹çš„å…ƒç´ è¢«ç§»é™¤äº†ï¼Œæ‰€ä»¥æ­¤æ—¶ lastRet æŒ‡å‘çš„å…ƒç´ æ˜¯åŸå…ˆ lastRet+1 ä½ç½®çš„å…ƒç´ 
            cursor = lastRet;
            lastRet = -1;
            //å› ä¸ºæ˜¯ Itr ä¸»åŠ¨å¯¹é›†åˆè¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥æ­¤å¤„éœ€è¦ä¸»åŠ¨æ›´æ–° expectedModCount å€¼ï¼Œé¿å…ä¹‹åæŠ›å‡ºå¼‚å¸¸
            expectedModCount = modCount;
        } catch (IndexOutOfBoundsException ex) {
            throw new ConcurrentModificationException();
        }
    }

    //éå†ä»ç´¢å¼• cursor å¼€å§‹ä¹‹åå‰©ä¸‹çš„å…ƒç´ 
    @Override
    @SuppressWarnings("unchecked")
    public void forEachRemaining(Consumer<? super E> consumer) {
        Objects.requireNonNull(consumer);
        final int size = ArrayList.this.size;
        int i = cursor;
        if (i >= size) {
            return;
        }
        final Object[] elementData = ArrayList.this.elementData;
        if (i >= elementData.length) {
            throw new ConcurrentModificationException();
        }
        //éå†è°ƒç”¨ accept æ–¹æ³•
        while (i != size && modCount == expectedModCount) {
            consumer.accept((E) elementData[i++]);
        }
        cursor = i;
        lastRet = i - 1;
        checkForComodification();
    }

    //åˆ¤æ–­è¿­ä»£å™¨åœ¨éå†é›†åˆçš„è¿‡ç¨‹ä¸­ï¼Œé›†åˆæ˜¯å¦è¢«å¤–éƒ¨æ”¹åŠ¨äº†ï¼ˆä¾‹å¦‚è¢«å…¶å®ƒè¿­ä»£å™¨ç§»é™¤äº†å…ƒç´ ï¼‰
    //å¦‚æœæ˜¯çš„è¯åˆ™æŠ›å‡ºå¼‚å¸¸
    final void checkForComodification() {
        if (modCount != expectedModCount)
            throw new ConcurrentModificationException();
    }
}
```

## 11ã€æ•ˆç‡æµ‹è¯•

æœ€åå†æ¥æµ‹è¯•ä¸‹ ArrayList æ‰©å®¹æ¬¡æ•°çš„é«˜ä½å¯¹å…¶è¿è¡Œæ•ˆç‡çš„å½±å“

å¯¹ä¸‰ä¸ª ArrayList å­˜å…¥ç›¸åŒæ•°æ®é‡çš„æ•°æ®ï¼Œä½†åˆ†åˆ«ä¸º ArrayList æŒ‡å®šä¸åŒçš„åˆå§‹åŒ–å¤§å°

```java
public static void main(String[] args) {
    long startTime = System.currentTimeMillis();
    List<String> stringList = new ArrayList<>();
    for (int i = 0; i < 300000; i++) {
        stringList.add("leavesC " + i);
    }
    long endTime = System.currentTimeMillis();
    System.out.println("åˆå§‹å®¹é‡ä¸º0ï¼Œæ‰€ç”¨æ—¶é—´ï¼š" + (endTime - startTime) + "æ¯«ç§’");


    startTime = System.currentTimeMillis();
    List<String> stringList2 = new ArrayList<>(100000);
    for (int i = 0; i < 300000; i++) {
        stringList2.add("leavesC " + i);
    }
    endTime = System.currentTimeMillis();
    System.out.println("åˆå§‹å®¹é‡ä¸º100000ï¼Œæ‰€ç”¨æ—¶é—´ï¼š" + (endTime - startTime) + "æ¯«ç§’");


    startTime = System.currentTimeMillis();
    List<String> stringList3 = new ArrayList<>(300000);
    for (int i = 0; i < 300000; i++) {
        stringList3.add("leavesC " + i);
    }
    endTime = System.currentTimeMillis();
    System.out.println("åˆå§‹å®¹é‡ä¸º300000ï¼Œæ‰€ç”¨æ—¶é—´ï¼š" + (endTime - startTime) + "æ¯«ç§’");
}
```

ä¸‰ç§æ–¹å¼ä¸‹ ArrayList ä¹‹é—´çš„è¿è¡Œæ•ˆç‡å·®è·è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œè™½ç„¶è¿™ç§æµ‹è¯•æ–¹æ³•å¹¶ä¸ä¸¥è°¨ï¼Œä½†ä¹Ÿå¯ä»¥çœ‹åˆ°åœ¨çœå»æ‰©å®¹æ“ä½œå ArrayList çš„è¿è¡Œæ•ˆç‡è¿˜æ˜¯æå‡äº†å¾ˆå¤šçš„

```java
åˆå§‹å®¹é‡ä¸º0ï¼Œæ‰€ç”¨æ—¶é—´ï¼š39æ¯«ç§’
åˆå§‹å®¹é‡ä¸º100000ï¼Œæ‰€ç”¨æ—¶é—´ï¼š32æ¯«ç§’
åˆå§‹å®¹é‡ä¸º300000ï¼Œæ‰€ç”¨æ—¶é—´ï¼š13æ¯«ç§’
```

# ä¸‰ã€LinkedList

LinkedList åŒæ—¶å®ç°äº† List æ¥å£å’Œ Deque æ¥å£ï¼Œæ‰€ä»¥æ—¢å¯ä»¥å°† LinkedList å½“åšä¸€ä¸ªæœ‰åºå®¹å™¨ï¼Œä¹Ÿå¯ä»¥å°†ä¹‹çœ‹ä½œä¸€ä¸ªé˜Ÿåˆ—ï¼ˆQueueï¼‰ï¼ŒåŒæ—¶åˆå¯ä»¥çœ‹ä½œä¸€ä¸ªæ ˆï¼ˆStackï¼‰ã€‚è™½ç„¶ LinkedList å’Œ ArrayList ä¸€æ ·éƒ½å®ç°äº† List æ¥å£ï¼Œä½†å…¶åº•å±‚æ˜¯é€šè¿‡**åŒå‘é“¾è¡¨**æ¥å®ç°çš„ï¼Œæ‰€ä»¥æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ•ˆç‡éƒ½è¦æ¯” ArrayList é«˜ï¼Œä½†ä¹Ÿå› æ­¤éšæœºè®¿é—®çš„æ•ˆç‡è¦æ¯” ArrayList ä½

## 1ã€ç±»å£°æ˜

ä» LinkedList å®ç°çš„å‡ ä¸ªæ¥å£å¯ä»¥çœ‹å‡ºæ¥ï¼ŒLinkedList æ˜¯æ”¯æŒå¿«é€Ÿè®¿é—®ï¼Œå¯å…‹éš†ï¼Œå¯åºåˆ—åŒ–çš„ï¼Œè€Œä¸”å¯ä»¥å°†ä¹‹çœ‹æˆä¸€ä¸ª**æ”¯æŒæœ‰åºè®¿é—®çš„é˜Ÿåˆ—æˆ–è€…æ ˆ**

```java
public class LinkedList<E> extends AbstractSequentialList<E> 
    implements List<E>, Deque<E>, Cloneable, java.io.Serializable
```

LinkedList å†…éƒ¨é€šè¿‡åŒå‘é“¾è¡¨çš„æ•°æ®ç»“æ„æ¥å®ç°çš„ï¼Œæ¯ä¸ªé“¾è¡¨ç»“ç‚¹é™¤äº†å­˜å‚¨æœ¬ç»“ç‚¹çš„æ•°æ®å…ƒç´ å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«ç”¨äºæŒ‡å‘å…¶ä¸Šä¸‹ä¸¤ä¸ªç›¸é‚»ç»“ç‚¹ï¼Œè¿™ä¸ªç»“ç‚¹å°±æ˜¯ LinkedList ä¸­çš„é™æ€ç±» Node

```java
private static class Node<E> {

    //å½“å‰ç»“ç‚¹åŒ…å«çš„å®é™…å…ƒç´ 
    E item;

    //æŒ‡å‘ä¸‹ä¸€ä¸ªç»“ç‚¹
    Node<E> next;

    //æŒ‡å‘ä¸Šä¸€ä¸ªç»“ç‚¹
    Node<E> prev;

    Node(Node<E> prev, E element, Node<E> next) {
        this.item = element;
        this.next = next;
        this.prev = prev;
    }
}
```

## 2ã€æˆå‘˜å˜é‡

```java
//åŒå‘é“¾è¡¨åŒ…å«çš„ç»“ç‚¹æ€»æ•°ï¼Œå³æ•°æ®æ€»é‡
transient int size = 0;

//åŒå‘é“¾è¡¨çš„å¤´ç»“ç‚¹
transient Node<E> first;

//åŒå‘é“¾è¡¨çš„å°¾ç»“ç‚¹
transient Node<E> last;

//åºåˆ—åŒ–ID
private static final long serialVersionUID = 876323262645176354L;
```

å½“ä¸­çš„æˆå‘˜å˜é‡ first å’Œ last åˆ†åˆ«ç”¨äºæŒ‡å‘é“¾è¡¨çš„å¤´éƒ¨å’Œå°¾éƒ¨ç»“ç‚¹ï¼Œå› æ­¤ LinkedList çš„æ•°æ®ç»“æ„å›¾æ˜¯ç±»ä¼¼äºè¿™æ ·çš„

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ea71d0950c04d8a947867ad892ff6c6~tplv-k3u1fbpfcp-zoom-1.image)

## 3ã€æ„é€ å‡½æ•°

LinkedList ä¸éœ€è¦å»è¯·æ±‚ä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´æ¥å­˜å‚¨æ•°æ®ï¼Œè€Œæ˜¯åœ¨æ¯æ¬¡æœ‰æ–°çš„å…ƒç´ éœ€è¦æ·»åŠ æ—¶å†æ¥åŠ¨æ€è¯·æ±‚å†…å­˜ç©ºé—´ï¼Œå› æ­¤ LinkedList çš„ä¸¤ä¸ªæ„é€ å‡½æ•°éƒ½å¾ˆç®€å•

```java
public LinkedList() {
}

//ä¼ å…¥åˆå§‹æ•°æ®
public LinkedList(Collection<? extends E> c) {
    this();
    addAll(c);
}
```

## 4ã€æ·»åŠ å…ƒç´ 

`add(E e)` æ–¹æ³•ç”¨äºå‘é“¾è¡¨çš„å°¾éƒ¨æ·»åŠ ç»“ç‚¹ï¼Œå› ä¸ºæœ‰ `last` æŒ‡å‘é“¾è¡¨çš„å°¾ç»“ç‚¹ï¼Œå› æ­¤å‘å°¾éƒ¨æ·»åŠ æ–°å…ƒç´ åªéœ€è¦ä¿®æ”¹å‡ ä¸ªå¼•ç”¨å³å¯ï¼Œæ•ˆç‡è¾ƒé«˜

```java
//å°†å…ƒç´  e ä½œä¸ºå°¾ç»“ç‚¹æ·»åŠ 
//å› ä¸º LinkedList å…è®¸æ·»åŠ ç›¸åŒå…ƒç´ ï¼Œæ‰€ä»¥æ­¤æ–¹æ³•å›ºå®šè¿”å› true
public boolean add(E e) {
    linkLast(e);
    return true;
}

//å°†å…ƒç´  e ç½®ä¸ºå°¾ç»“ç‚¹
void linkLast(E e) {
    //å…ˆä¿å­˜åŸå°¾ç»“ç‚¹
    final Node<E> l = last;
    //æ„å»ºæ–°çš„å°¾ç»“ç‚¹ï¼Œå¹¶æŒ‡å‘åŸå°¾ç»“ç‚¹
    final Node<E> newNode = new Node<>(l, e, null);
    last = newNode;
    //å¦‚æœåŸå°¾ç»“ç‚¹ä¸º nullï¼Œè¯´æ˜åŸé“¾è¡¨åŒ…å«çš„å…ƒç´ ä¸ªæ•°ä¸º 0ï¼Œåˆ™æ­¤æ—¶æ’å…¥çš„å°¾ç»“ç‚¹åŒæ—¶å³ä¸ºå¤´ç»“ç‚¹
    //å¦‚æœåŸå°¾ç»“ç‚¹ä¸ä¸º nullï¼Œåˆ™å°† next æŒ‡å‘æ–°çš„å°¾ç»“ç‚¹
    if (l == null)
        first = newNode;
    else
        l.next = newNode;
    //å…ƒç´ ä¸ªæ•°åŠ 1
    size++;
    modCount++;
}
```

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/83bed0a5917a494c88aa6edc2be08ab6~tplv-k3u1fbpfcp-zoom-1.image)

`add(int index, E element)` æ–¹æ³•ç”¨äºå‘æŒ‡å®šç´¢å¼•å¤„æ·»åŠ å…ƒç´ ï¼Œéœ€è¦å…ˆé€šè¿‡ç´¢å¼• index è·å–ç›¸åº”ä½ç½®çš„ç»“ç‚¹ï¼Œå¹¶åœ¨è¯¥ä½ç½®å¼€è¾Ÿä¸€ä¸ªæ–°çš„ç»“ç‚¹æ¥å­˜å‚¨å…ƒç´  elementï¼Œæœ€åè¿˜éœ€è¦ä¿®æ”¹ç›¸é‚»ç»“ç‚¹é—´çš„å¼•ç”¨

```java
//åœ¨ç´¢å¼• index å¤„æ’å…¥å…ƒç´  element
public void add(int index, E element) {
    //åˆ¤æ–­ç´¢å¼•å¤§å°æ˜¯å¦åˆæ³•ï¼Œä¸åˆæ³•åˆ™æŠ›å‡º IndexOutOfBoundsException
    checkPositionIndex(index);
    //å¦‚æœ index == sizeï¼Œåˆ™å°† element ä½œä¸ºå°¾ç»“ç‚¹æ¥æ·»åŠ 
    //å¦åˆ™åˆ™åœ¨ç´¢å¼• index å‰å¼€è¾Ÿä¸€ä¸ªæ–°ç»“ç‚¹
    if (index == size)
        linkLast(element);
    else
        linkBefore(element, node(index));
}

//å°†å…ƒç´  e ç½®ä¸º succ ç»“ç‚¹çš„ä¸Šä¸€ä¸ªç»“ç‚¹
void linkBefore(E e, Node<E> succ) {
    //ä¿å­˜ succ çš„ä¸Šä¸€ä¸ªç»“ç‚¹ä¿¡æ¯
    final Node<E> pred = succ.prev;
    //æ„å»ºå…ƒç´  e å¯¹åº”çš„ç»“ç‚¹
    final Node<E> newNode = new Node<>(pred, e, succ);
    //å°†ç»“ç‚¹ succ çš„ä¸Šä¸€ä¸ªç»“ç‚¹æŒ‡å‘ newNode
    succ.prev = newNode;
    //å¦‚æœ pred ä¸º nullï¼Œè¯´æ˜ succ æ˜¯å¤´ç»“ç‚¹ï¼Œåˆ™å°† newNode ç½®ä¸ºæ–°çš„å¤´ç»“ç‚¹
    if (pred == null)
        first = newNode;
    else
        pred.next = newNode;
    //å…ƒç´ ä¸ªæ•°åŠ 1
    size++;
    modCount++;
}
```

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6853b99e131840ccb6c4efaa2584e399~tplv-k3u1fbpfcp-zoom-1.image)

## 5ã€ç§»é™¤å…ƒç´ 

`remove()` æ–¹æ³•æœ‰ä¸¤ç§é‡è½½å½¢å¼ï¼Œå…¶å†…éƒ¨éƒ½æ˜¯é€šè¿‡è°ƒç”¨ `unlink(Node<E> x)` æ–¹æ³•æ¥ç§»é™¤æŒ‡å®šç»“ç‚¹åœ¨é“¾è¡¨ä¸­çš„å¼•ç”¨ï¼Œä¸åŒäº ArrayList åœ¨ç§»é™¤å…ƒç´ æ—¶å¯èƒ½å¯¼è‡´çš„å¤§é‡æ•°æ®ç§»åŠ¨ï¼ŒLinkedList åªéœ€è¦é€šè¿‡ç§»é™¤å¼•ç”¨å³å¯å°†æŒ‡å®šå…ƒç´ ä»é“¾è¡¨ä¸­ç§»é™¤

```java
//ç§»é™¤ç´¢å¼• index å¤„çš„ç»“ç‚¹
public E remove(int index) {
    //åˆ¤æ–­ç´¢å¼•å¤§å°æ˜¯å¦åˆæ³•ï¼Œä¸åˆæ³•åˆ™æŠ›å‡º IndexOutOfBoundsException
    checkElementIndex(index);
    return unlink(node(index));
}

//å¯¹é“¾è¡¨è¿›è¡Œæ­£å‘éå†ï¼Œç§»é™¤ç¬¬ä¸€ä¸ªå…ƒç´ å€¼ä¸º o çš„ç»“ç‚¹
//å¦‚æœç§»é™¤æˆåŠŸåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› false
public boolean remove(Object o) {
    if (o == null) {
        for (Node<E> x = first; x != null; x = x.next) {
            if (x.item == null) {
                //ç§»é™¤ç»“ç‚¹ x
                unlink(x);
                return true;
            }
        }
    } else {
        for (Node<E> x = first; x != null; x = x.next) {
            if (o.equals(x.item)) {
                //ç§»é™¤ç»“ç‚¹ x
                unlink(x);
                return true;
            }
        }
    }
    return false;
}

//ç§»é™¤ç»“ç‚¹ x å¹¶è¿”å›å…¶åŒ…å«çš„å…ƒç´ å€¼
E unlink(Node<E> x) {
    final E element = x.item;
    final Node<E> next = x.next;
    final Node<E> prev = x.prev;
    //å¦‚æœ prev == nullï¼Œè¯´æ˜ç»“ç‚¹ x ä¸ºå¤´ç»“ç‚¹ï¼Œåˆ™å°†å¤´ç»“ç‚¹ç½®ä¸ºåŸå…ˆçš„ç¬¬äºŒä¸ªç»“ç‚¹
    //å¦‚æœ prev != nullï¼Œåˆ™ç§»é™¤å¯¹ç»“ç‚¹ x çš„å¼•ç”¨
    if (prev == null) {
        first = next;
    } else {
        prev.next = next;
        x.prev = null;
    }
    //å¦‚æœ next == nullï¼Œåˆ™è¯´æ˜ç»“ç‚¹ x ä¸ºå°¾ç»“ç‚¹ï¼Œåˆ™å°†å°¾ç»“ç‚¹ç½®ä¸ºåŸå…ˆçš„å€’æ•°ç¬¬äºŒä¸ªç»“ç‚¹
    //å¦‚æœ next != nullï¼Œåˆ™ç§»é™¤å¯¹ç»“ç‚¹ x çš„å¼•ç”¨
    if (next == null) {
        last = prev;
    } else {
        next.prev = prev;
        x.next = null;
    }
    //å¸®åŠ©GCå›æ”¶
    x.item = null;
    //å…ƒç´ ä¸ªæ•°å‡1
    size--;
    modCount++;
    return element;
}
```

## 6ã€éšæœºè®¿é—®å…ƒç´ 

å¯¹äºå•å‘é“¾è¡¨æ¥è¯´ï¼Œå¦‚æœæƒ³éšæœºå®šä½åˆ°æŸä¸ªç»“ç‚¹ï¼Œé‚£ä¹ˆåªèƒ½é€šè¿‡ä»å¤´ç»“ç‚¹å¼€å§‹éå†çš„æ–¹å¼æ¥å®šä½ï¼Œæœ€æç«¯çš„æƒ…å†µä¸‹éœ€è¦éå†æ•´ä¸ªé“¾è¡¨æ‰èƒ½å®šä½åˆ°ç›®æ ‡ç»“ç‚¹ã€‚å¦‚æœæ˜¯åŒå‘é“¾è¡¨ï¼Œåˆ™å¯ä»¥é€‰æ‹©æ­£å‘éå†æˆ–è€…åå‘éå†ï¼Œæœ€æç«¯çš„æƒ…å†µä¸‹éœ€è¦éå†ä¸€åŠé“¾è¡¨æ‰èƒ½å®šä½åˆ°ç›®æ ‡ç»“ç‚¹ã€‚æ‰€ä»¥ï¼Œç›¸æ¯”æ•°ç»„æ¥è¯´ LinkedList çš„éšæœºè®¿é—®æ•ˆç‡å¹¶ä¸é«˜

```java
//è·å–ç´¢å¼• index å¤„çš„ç»“ç‚¹å…ƒç´ 
public E get(int index) {
    //åˆ¤æ–­ç´¢å¼•å¤§å°æ˜¯å¦åˆæ³•ï¼Œä¸åˆæ³•åˆ™æŠ›å‡º IndexOutOfBoundsException
    checkElementIndex(index);
    return node(index).item;
}

//å°†ç´¢å¼• index å¤„çš„ç»“ç‚¹åŒ…å«çš„å…ƒç´ ä¿®æ”¹ä¸º elementï¼Œå¹¶è¿”å›æ—§å…ƒç´ 
public E set(int index, E element) {
    //åˆ¤æ–­ç´¢å¼•å¤§å°æ˜¯å¦åˆæ³•ï¼Œä¸åˆæ³•åˆ™æŠ›å‡º IndexOutOfBoundsException
    checkElementIndex(index);
    Node<E> x = node(index);
    E oldVal = x.item;
    x.item = element;
    return oldVal;
}

//è·å–ç´¢å¼• index å¤„çš„ç»“ç‚¹
Node<E> node(int index) {
    //size >> 1 çš„å«ä¹‰å³ä¸ºï¼šå°† size å€¼é™¤ä»¥ 2
    //å¦‚æœ index é è¿‘é“¾è¡¨çš„å¤´éƒ¨ï¼Œåˆ™ä»å¤´éƒ¨å‘å°¾éƒ¨æ­£å‘éå†æŸ¥æ‰¾ç»“ç‚¹
    //å¦‚æœ index é è¿‘é“¾è¡¨çš„å°¾éƒ¨ï¼Œåˆ™ä»å°¾éƒ¨å‘å¤´éƒ¨åå‘éå†æŸ¥æ‰¾ç»“ç‚¹
    //æœ€æç«¯çš„æƒ…å†µä¸‹éå†ä¸€åŠå…ƒç´ æ‰èƒ½å®šä½åˆ°ç›®æ ‡èŠ‚ç‚¹
    if (index < (size >> 1)) {
        Node<E> x = first;
        for (int i = 0; i < index; i++)
            x = x.next;
        return x;
    } else {
        Node<E> x = last;
        for (int i = size - 1; i > index; i--)
            x = x.prev;
        return x;
    }
}
```

## 7ã€å‡ ä¸ªå¸¸ç”¨çš„æ–¹æ³•

```java
//åˆ¤æ–­æ˜¯å¦åŒ…å«å…ƒç´  o
public boolean contains(Object o) {
    return indexOf(o) != -1;
}

//è·å–å…ƒç´ ä¸ªæ•°
public int size() {
    return size;
}

//æ¸…ç©ºé“¾è¡¨å…ƒç´ ï¼Œå°†å„ä¸ªç»“ç‚¹ä¹‹é—´çš„å¼•ç”¨éƒ½åˆ‡æ–­
public void clear() {
    for (Node<E> x = first; x != null; ) {
        Node<E> next = x.next;
        x.item = null;
        x.next = null;
        x.prev = null;
        x = next;
    }
    first = last = null;
    size = 0;
    modCount++;
}

//è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ å€¼ä¸º o çš„ç»“ç‚¹æ‰€åœ¨çš„ç´¢å¼•å€¼
//å¦‚æœæŸ¥æ‰¾ä¸åˆ°ï¼Œåˆ™è¿”å› -1
public int indexOf(Object o) {
    int index = 0;
    if (o == null) {
        for (Node<E> x = first; x != null; x = x.next) {
            if (x.item == null)
                return index;
            index++;
        }
    } else {
        for (Node<E> x = first; x != null; x = x.next) {
            if (o.equals(x.item))
                return index;
            index++;
        }
    }
    return -1;
}

//è¿”å›æœ€åä¸€ä¸ªå…ƒç´ å€¼ä¸º o çš„ç»“ç‚¹æ‰€åœ¨çš„ç´¢å¼•å€¼
//å¦‚æœæŸ¥æ‰¾ä¸åˆ°ï¼Œåˆ™è¿”å› -1
public int lastIndexOf(Object o) {
    int index = size;
    if (o == null) {
        for (Node<E> x = last; x != null; x = x.prev) {
            index--;
            if (x.item == null)
                return index;
        }
    } else {
        for (Node<E> x = last; x != null; x = x.prev) {
            index--;
            if (o.equals(x.item))
                return index;
        }
    }
    return -1;
}
```

## 8ã€Deque æ¥å£

ä»¥ä¸Šä»‹ç»çš„å‡ ä¸ªæ–¹æ³•éƒ½æ˜¯ List æ¥å£ä¸­æ‰€å£°æ˜çš„ï¼Œæ¥ä¸‹æ¥çœ‹ä¸‹ Deque æ¥å£ä¸­çš„æ–¹æ³•

å…¶å® Deque æ¥å£ä¸­å¾ˆå¤šæ–¹æ³•çš„å«ä¹‰éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œä¸”ä¸€äº›æ–¹æ³•éƒ½æ˜¯ç›¸äº’è°ƒç”¨çš„ï¼Œå¹¶ä¸ç®—å¤æ‚

```java
//å°†å…ƒç´  e ç½®ä¸ºå¤´ç»“ç‚¹
public void addFirst(E e) {
    linkFirst(e);
}

//å°†å…ƒç´  e ç½®ä¸ºå°¾ç»“ç‚¹
public void addLast(E e) {
    linkLast(e);
}

//å°†å…ƒç´  e ä½œä¸ºå°¾ç»“ç‚¹æ·»åŠ 
public boolean offer(E e) {
    return add(e);
}

//å°†å…ƒç´  e ä½œä¸ºå¤´ç»“ç‚¹æ·»åŠ 
public boolean offerFirst(E e) {
    addFirst(e);
    return true;
}

//å°†å…ƒç´  e ä½œä¸ºå°¾ç»“ç‚¹æ·»åŠ 
public boolean offerLast(E e) {
    addLast(e);
    return true;
}

//è·å–å¤´éƒ¨ç»“ç‚¹çš„å…ƒç´ å€¼
public E peekFirst() {
    final Node<E> f = first;
    return (f == null) ? null : f.item;
}

//è·å–å°¾éƒ¨ç»“ç‚¹çš„å…ƒç´ å€¼
public E peekLast() {
    final Node<E> l = last;
    return (l == null) ? null : l.item;
}

//è·å–å¤´éƒ¨ç»“ç‚¹çš„å…ƒç´ å€¼ï¼Œå¹¶å°†ä¹‹ä»é“¾è¡¨ä¸­ç§»é™¤
public E pollFirst() {
    final Node<E> f = first;
    return (f == null) ? null : unlinkFirst(f);
}

//è·å–å°¾éƒ¨ç»“ç‚¹çš„å…ƒç´ å€¼ï¼Œå¹¶å°†ä¹‹ä»é“¾è¡¨ä¸­ç§»é™¤
public E pollLast() {
    final Node<E> l = last;
    return (l == null) ? null : unlinkLast(l);
}

//å°†å…ƒç´  e ä½œä¸ºå¤´ç»“ç‚¹æ·»åŠ 
public void push(E e) {
    addFirst(e);
}

//è·å–å¤´éƒ¨ç»“ç‚¹çš„å…ƒç´ å€¼ï¼Œå¹¶å°†ä¹‹ä»é“¾è¡¨ä¸­ç§»é™¤
public E pop() {
    return removeFirst();
}

//ä»é“¾è¡¨å¤´éƒ¨å‘å°¾éƒ¨æ­£å‘éå†ï¼Œç§»é™¤ç¬¬ä¸€ä¸ªå…ƒç´ å€¼ä¸º o çš„ç»“ç‚¹
//å¦‚æœç§»é™¤æˆåŠŸåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› false
public boolean removeFirstOccurrence(Object o) {
    return remove(o);
}

//ä»é“¾è¡¨å°¾éƒ¨å‘å¤´éƒ¨åå‘éå†ï¼Œç§»é™¤ç¬¬ä¸€ä¸ªå…ƒç´ å€¼ä¸º o çš„ç»“ç‚¹
//å¦‚æœç§»é™¤æˆåŠŸåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› false
public boolean removeLastOccurrence(Object o) {
    if (o == null) {
        for (Node<E> x = last; x != null; x = x.prev) {
            if (x.item == null) {
                unlink(x);
                return true;
            }
        }
    } else {
        for (Node<E> x = last; x != null; x = x.prev) {
            if (o.equals(x.item)) {
                unlink(x);
                return true;
            }
        }
    }
    return false;
}
```

## 9ã€æ•ˆç‡æµ‹è¯•

ä¸Šé¢è¯´è¿‡ï¼ŒLinkedList ç›¸æ¯” ArrayList åœ¨æ·»åŠ å’Œç§»é™¤å…ƒç´ æ—¶æ•ˆç‡ä¸Šä¼šé«˜å¾ˆå¤šï¼Œä½†éšæœºè®¿é—®å…ƒç´ çš„æ•ˆç‡è¦æ¯” ArrayList ä½ï¼Œè¿™é‡Œä¹Ÿæ¥åšä¸ªæµ‹è¯•ï¼ŒéªŒè¯ä¸¤è€…ä¹‹é—´çš„å·®åˆ«

åˆ†åˆ«å‘ ArrayList å’Œ LinkedList å­˜å…¥åŒç­‰æ•°æ®é‡çš„æ•°æ®ï¼Œç„¶åå„è‡ªç§»é™¤ 100 ä¸ªå…ƒç´ ä»¥åŠéå† 10000 ä¸ªå…ƒç´ ï¼Œè§‚å¯Ÿä¸¤è€…æ‰€ç”¨çš„æ—¶é—´

ArrayListï¼š

```java
public static void main(String[] args) {
    List<String> stringArrayList = new ArrayList<>();
    for (int i = 0; i < 300000; i++) {
        stringArrayList.add("leavesC " + i);
    }

    long startTime = System.currentTimeMillis();
    for (int i = 0; i < 100; i++) {
        stringArrayList.remove(100 + i);
    }
    long endTime = System.currentTimeMillis();
    System.out.println("ç§»é™¤ ArrayList ä¸­çš„100ä¸ªå…ƒç´ ,ç”¨æ—¶ï¼š" + (endTime - startTime) + "æ¯«ç§’");

    startTime = System.currentTimeMillis();
    for (int i = 0; i < 10000; i++) {
        stringArrayList.get(i);
    }
    endTime = System.currentTimeMillis();
    System.out.println("éå† ArrayList ä¸­çš„10000ä¸ªå…ƒç´ ,ç”¨æ—¶ï¼š" + (endTime - startTime) + "æ¯«ç§’");
}
```

LinkedListï¼š

```java
public static void main(String[] args) {
    List<String> stringLinkedList = new LinkedList<>();
    for (int i = 0; i < 300000; i++) {
        stringLinkedList.add("leavesC " + i);
    }

    long startTime = System.currentTimeMillis();
    for (int i = 0; i < 100; i++) {
        stringLinkedList.remove(100 + i);
    }
    long endTime = System.currentTimeMillis();
    System.out.println("ç§»é™¤ LinkedList ä¸­çš„100ä¸ªå…ƒç´ ,ç”¨æ—¶ï¼š" + (endTime - startTime) + "æ¯«ç§’");

    startTime = System.currentTimeMillis();
    for (int i = 0; i < 10000; i++) {
        stringLinkedList.get(i);
    }
    endTime = System.currentTimeMillis();
    System.out.println("éå† LinkedList ä¸­çš„10000ä¸ªå…ƒç´ ,ç”¨æ—¶ï¼š" + (endTime - startTime) + "æ¯«ç§’");
}

```

å¯ä»¥çœ‹å‡ºæ¥ä¸¤è€…ä¹‹é—´çš„å·®è·è¿˜æ˜¯éå¸¸å¤§çš„ï¼Œåœ¨ä½¿ç”¨é›†åˆæ¡†æ¶å‰éœ€è¦æ ¹æ®å®é™…åº”ç”¨åœºæ™¯æ¥å†³å®šä½¿ç”¨å“ªä¸€ä¸ª

```java
ç§»é™¤ ArrayList ä¸­çš„100ä¸ªå…ƒç´ ,ç”¨æ—¶ï¼š18æ¯«ç§’
éå† ArrayList ä¸­çš„10000ä¸ªå…ƒç´ ,ç”¨æ—¶ï¼š1æ¯«ç§’
    
ç§»é™¤ LinkedList ä¸­çš„100ä¸ªå…ƒç´ ,ç”¨æ—¶ï¼š0æ¯«ç§’
éå† LinkedList ä¸­çš„10000ä¸ªå…ƒç´ ,ç”¨æ—¶ï¼š237æ¯«ç§’
```